<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LS Betting</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Importar uma fonte bonita, como a do exemplo */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');

        :root {
            --bg-color: #1f2937;
            /* Cinza escuro azulado */
            --card-color: #374151;
            /* Cinza médio */
            --border-color: #4b5563;
            /* Cinza para bordas */
            --text-color: #f3f4f6;
            /* Texto claro */
            --text-muted-color: #9ca3af;
            /* Texto secundário */
            --primary-color: #3b82f6;
            /* Azul primário */
            --primary-text-color: #ffffff;
            /* Texto do botão primário */
            --green-color: #22c55e;
            --red-color: #ef4444;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 2rem;
        }

        /* === TELA DE LOGIN === */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .auth-card {
            background-color: var(--card-color);
            padding: 2rem;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--border-color);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .auth-error {
            color: var(--red-color);
            margin-bottom: 1rem;
            font-size: 0.9rem;
            min-height: 1.2em;
        }

        .auth-toggle-message {
            margin-top: 1.5rem;
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted-color);
        }

        .link-button {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 700;
            padding: 0;
        }

        /* === CABEÇALHO === */
        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background-color: var(--card-color);
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .main-nav,
        .user-menu {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .nav-link {
            color: var(--text-muted-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: color 0.2s;
            cursor: pointer;
        }

        .nav-link:hover,
        .nav-link.active {
            color: var(--text-color);
        }

        .user-profile {
            font-weight: 500;
        }

        .subscription-status {
            font-size: 0.9rem;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-weight: 700;
        }

        .subscription-status.active {
            background-color: rgba(34, 197, 94, 0.2);
            color: var(--green-color);
        }

        .subscription-status.expired {
            background-color: rgba(239, 68, 68, 0.2);
            color: var(--red-color);
        }

        .card {
            background-color: var(--card-color);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        h2,
        h3 {
            margin: 0;
            font-weight: 500;
        }

        input,
        select,
        textarea {
            background-color: #4b5563;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 0.75rem;
            color: var(--text-color);
            font-size: 1rem;
            width: 100%;
            box-sizing: border-box;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
        }

        .button-primary {
            background-color: var(--primary-color);
            color: var(--primary-text-color);
            border: none;
            border-radius: 6px;
            padding: 0.75rem 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .button-primary:hover {
            background-color: #2563eb;
        }

        .summary-container {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .stats-summary-card .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .stats-summary-card .stat-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .stats-summary-card .stat-item:first-child {
            padding-top: 0;
        }

        .stat-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat-icon {
            background-color: #4b5563;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1.2rem;
        }

        .stat-icon.icon-green {
            color: var(--green-color);
        }

        .stat-icon.icon-yellow {
            color: var(--primary-color);
        }

        .stat-text p {
            margin: 0;
            color: var(--text-muted-color);
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .chart-card {
            position: relative;
            height: 250px;
            display: flex;
            flex-direction: column;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .chart-toggle {
            background-color: #4b5563;
            border-radius: 6px;
            padding: 4px;
            display: flex;
        }

        .chart-toggle-btn {
            background: none;
            border: none;
            color: var(--text-muted-color);
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 700;
        }

        .chart-toggle-btn.active {
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .notes-card textarea {
            height: calc(100% - 40px);
        }

        .empty-state {
            text-align: center;
            padding: 4rem 0;
            color: var(--text-muted-color);
        }

        .empty-state a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 700;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--card-color);
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }

        .close-button {
            background: none;
            border: none;
            color: var(--text-muted-color);
            font-size: 2rem;
            cursor: pointer;
        }

        fieldset {
            border: none;
            padding: 0;
            margin: 0 0 1.5rem 0;
        }

        fieldset legend {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        fieldset legend span {
            background-color: var(--primary-color);
            color: var(--primary-text-color);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            font-size: 0.9rem;
            font-weight: bold;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-muted-color);
        }

        .form-grid-double {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .status-options {
            display: flex;
            gap: 1rem;
            background-color: #4b5563;
            border-radius: 6px;
            padding: 0.5rem;
        }

        .status-options input[type="radio"] {
            display: none;
        }

        .status-options label {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
            width: 100%;
            text-align: center;
            margin: 0;
        }

        .status-options input[type="radio"]:checked+label {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-weight: 500;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }

        .button-secondary {
            background-color: #4b5563;
            color: var(--text-color);
            border: none;
            border-radius: 6px;
            padding: 0.75rem 1.5rem;
            font-weight: 700;
            cursor: pointer;
        }

        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 700;
            text-align: center;
            min-width: 100px;
            display: inline-block;
            box-sizing: border-box;
        }

        .status-badge.status-concluído {
            background-color: rgba(34, 197, 94, 0.2);
            color: var(--green-color) !important;
        }

        .status-badge.status-em-andamento {
            background-color: rgba(59, 130, 246, 0.2);
            color: var(--primary-color);
        }

        .status-badge.status-aguardando-freebet {
            background-color: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .bets-grid-container {
            display: grid;
            grid-template-columns: 40px 95px 1fr 1fr 2fr 1.2fr 1fr 110px 100px;
            gap: 1rem;
            padding: 0 1.5rem;
            border-bottom: 1px solid var(--border-color);
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .grid-row {
            display: grid;
            grid-template-columns: 40px 95px 1fr 1fr 2fr 1.2fr 1fr 110px 100px;
            gap: 1rem;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.2s;
        }

        .grid-row:last-child {
            border-bottom: none;
        }

        .grid-row:hover {
            background-color: #4b556360;
        }

        .grid-cell {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-weight: 500;
            color: var(--text-color);
        }

        .grid-header .grid-cell {
            font-weight: 700;
            color: var(--primary-color);
        }

        .resultado-positivo {
            color: var(--green-color);
            font-weight: 700;
        }

        .resultado-negativo {
            color: var(--red-color);
            font-weight: 700;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .button-icon,
        .action-btn {
            background: #4b5563;
            border: none;
            color: var(--text-muted-color);
            width: 36px;
            height: 36px;
            border-radius: 6px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s, color 0.2s;
        }

        .button-icon:hover,
        .action-btn:hover {
            color: var(--text-color);
        }

        .button-danger:hover {
            background-color: var(--red-color);
        }

        .text-green {
            color: var(--green-color);
        }

        .text-yellow {
            color: var(--primary-color);
        }

        .text-light {
            color: var(--text-color);
        }

        /* ADMIN PANEL */
        .admin-content {
            display: grid;
            grid-template-columns: 2fr 1fr auto;
            gap: 1rem;
            align-items: flex-end;
        }

        .admin-message {
            margin-top: 1rem;
            font-weight: 700;
        }

        /* ======================================= */
        /* ========== ESTILOS RESPONSIVOS ========== */
        /* ======================================= */

        /* Aplica para telas com largura máxima de 768px (tablets e celulares) */
        @media (max-width: 768px) {

            /* --- AJUSTES GERAIS --- */
            .container {
                padding: 1rem;
            }

            h2 {
                font-size: 1.2rem;
            }

            /* --- CABEÇALHO --- */
            .main-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .main-nav {
                flex-wrap: wrap;
                /* Permite que os links quebrem a linha */
                gap: 1rem;
            }

            .user-menu {
                width: 100%;
                justify-content: space-between;
            }


            /* --- PAINEL DE RESUMO E GRÁFICO --- */
            .summary-container {
                /* Muda o grid para uma única coluna */
                grid-template-columns: 1fr;
            }

            .chart-card {
                /* Garante que o gráfico não fique espremido */
                height: 300px;
            }


            /* --- FILTROS --- */
            .filters {
                /* Muda para uma coluna para empilhar os filtros */
                grid-template-columns: 1fr;
            }


            /* --- LISTA DE APOSTAS (A TRANSFORMAÇÃO MAIS IMPORTANTE) --- */

            /* 1. Esconde o cabeçalho da tabela no mobile */
            .bets-grid-container.grid-header {
                display: none;
            }

            /* 2. Remove o estilo de grid fixo da lista */
            .bets-list {
                padding: 0;
            }

            /* 3. Transforma cada linha de aposta em um "card" */
            .grid-row {
                grid-template-columns: 1fr 1fr;
                /* Duas colunas para os dados */
                grid-template-areas:
                    "data status"
                    "nome nome"
                    "casa casa"
                    "obs obs"
                    "tipo resultado"
                    "acoes acoes";
                gap: 0.75rem;
                padding: 1rem;
                margin-bottom: 1rem;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                background-color: #3a3a3a20;
            }

            /* 4. Adiciona "labels" (etiquetas) para cada dado */
            .grid-row .grid-cell::before {
                content: attr(data-label);
                font-weight: 700;
                color: var(--primary-color);
                display: block;
                margin-bottom: 0.25rem;
                font-size: 0.8rem;
            }

            /* 5. Remove o "::before" de células que não precisam de label */
            .grid-row .grid-cell.action-buttons::before,
            .grid-row .grid-cell[data-label="Status"]::before {
                display: none;
            }
            
            /* 6. Esconde a coluna de ID, que é menos importante no celular */
            .grid-row .grid-cell[data-label="ID"] {
                 display: none;
            }

            /* 7. Reorganiza as células dentro do novo layout de "card" */
            .grid-row .grid-cell {
                white-space: normal;
                padding: 0;
            }

            .grid-row .grid-cell[data-label="Data"] { grid-area: data; }
            .grid-row .grid-cell[data-label="Nome"] { grid-area: nome; }
            .grid-row .grid-cell[data-label="Casa"] { grid-area: casa; }
            .grid-row .grid-cell[data-label="Obs"] { grid-area: obs; }
            .grid-row .grid-cell[data-label="Resultado"] { grid-area: resultado; text-align: right;}
            .grid-row .grid-cell[data-label="Tipo"] { grid-area: tipo; }
            .grid-row .grid-cell[data-label="Status"] { grid-area: status; }
            .grid-row .grid-cell[data-label="Ações"] { grid-area: acoes; }

            .status-badge {
                min-width: unset;
                width: 100%;
            }

            .action-buttons {
                justify-content: flex-start;
                /* Alinha botões à esquerda no card */
            }

            /* --- MODAL DE NOVA APOSTA --- */
            .modal-content {
                width: 95%;
                padding: 1.5rem;
            }

            .form-grid-double {
                grid-template-columns: 1fr;
                /* Empilha os campos */
            }

            .modal-footer {
                flex-direction: column-reverse;
                /* Empilha os botões */
            }

            .modal-footer .button-primary,
            .modal-footer .button-secondary {
                width: 100%;
                text-align: center;
            }

            /* --- PAINEL DE ADMIN --- */
            .admin-content {
                grid-template-columns: 1fr;
                /* Empilha os campos do admin */
            }
        }
    </style>
</head>

<body>

    <!-- TELA DE LOGIN / CADASTRO -->
    <div id="auth-container" class="auth-container">
        <div class="auth-card">
            <h2 id="auth-title">Login</h2>
            <form id="auth-form">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" required>
                </div>
                <div id="auth-error" class="auth-error"></div>
                <button type="submit" id="auth-button" class="button-primary">Entrar</button>
            </form>
            <p class="auth-toggle-message">
                <span id="auth-message">Não tem uma conta?</span>
                <button id="auth-toggle-button" class="link-button">Crie uma agora</button>
            </p>
        </div>
    </div>

    <!-- APLICAÇÃO PRINCIPAL (ESCONDIDA POR PADRÃO) -->
    <div id="app-container" style="display: none;">
        <header class="main-header">
            <div class="logo">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <span>LS Betting</span>
            </div>
            <nav class="main-nav">
                <a href="#" class="nav-link active">Início</a>
                <a href="#" id="novaApostaHeaderBtn" class="nav-link">+ Nova Aposta</a>
                <a href="#" class="nav-link">Balanços</a>
                <a href="#" class="nav-link">Calculadora</a>
            </nav>
            <div class="user-menu">
                <div id="subscription-status" class="subscription-status"></div>
                <span id="userEmailDisplay" class="nav-link user-profile"></span>
                <button id="logout-button" class="link-button">Sair</button>
            </div>
        </header>

        <div id="app-content" class="container">
            <!-- PAINEL DE ADMIN (ESCONDIDO POR PADRÃO) -->
            <section id="admin-panel" class="card" style="display: none;">
                <div class="card-header">
                    <h2>Painel de Administração</h2>
                </div>
                <div class="admin-content">
                    <div class="form-group">
                        <label for="user-select">Selecionar Utilizador</label>
                        <select id="user-select"></select>
                    </div>
                    <div class="form-group">
                        <label for="days-to-add">Dias para Adicionar</label>
                        <input type="number" id="days-to-add" placeholder="Ex: 30">
                    </div>
                    <button id="add-days-btn" class="button-primary">Adicionar Dias</button>
                </div>
                <div id="admin-message" class="admin-message"></div>
            </section>

            <section class="card">
                <div class="card-header">
                    <h2>Filtros Avançados</h2>
                    <button id="limparFiltrosBtn" class="link-button">Limpar Filtros</button>
                </div>
                <div class="filters">
                    <input type="text" id="filtroNome" placeholder="🔎 Nome">
                    <input type="text" placeholder="Selecionar período...">
                    <select id="filtroCasa">
                        <option value="todas">Todas as Casas</option>
                    </select>
                    <select id="filtroTipo">
                        <option value="todos">Todos os Tipos</option>
                        <option value="Normal">Normal</option>
                        <option value="Multipla">Múltipla</option>
                        <option value="Surebet">Surebet</option>
                        <option value="Rodadas Gratis">Rodadas Gratis</option>
                        <option value="Metodos">Metodos</option>
                        <option value="Freebet">Freebet</option>
                    </select>
                    <select id="filtroStatus">
                        <option value="todos">Todos os Status</option>
                        <option value="Concluído">Concluído</option>
                        <option value="Em andamento">Em andamento</option>
                        <option value="Aguardando Freebet">Aguardando Freebet</option>
                    </select>
                </div>
            </section>

            <div class="summary-container">
                <section class="card stats-summary-card">
                    <div class="stat-item">
                        <div class="stat-info">
                            <div class="stat-icon icon-green">$</div>
                            <div class="stat-text">
                                <p>Lucro Total</p>
                            </div>
                        </div>
                        <div id="lucroTotalValue" class="stat-value text-green">R$ 0,00</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-info">
                            <div class="stat-icon icon-yellow">📈</div>
                            <div class="stat-text">
                                <p>Lucro Médio</p>
                            </div>
                        </div>
                        <div id="lucroMedioValue" class="stat-value text-yellow">R$ 0,00</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-info">
                            <div class="stat-icon icon-yellow">🕒</div>
                            <div class="stat-text">
                                <p>Apostas em Andamento</p>
                            </div>
                        </div>
                        <div id="apostasAndamentoValue" class="stat-value text-light">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-info">
                            <div class="stat-icon icon-green">✅</div>
                            <div class="stat-text">
                                <p>Apostas Concluídas</p>
                            </div>
                        </div>
                        <div id="apostasConcluidasValue" class="stat-value text-light">0</div>
                    </div>
                </section>
                <section class="card chart-card">
                    <div class="chart-header">
                        <h3 id="chartTitle">Lucro Diário</h3>
                        <div class="chart-toggle"><button id="chartDailyBtn" class="chart-toggle-btn active">D</button><button id="chartMonthlyBtn" class="chart-toggle-btn">M</button></div>
                    </div>
                    <canvas id="graficoLucroDiario"></canvas>
                </section>
                <section class="card notes-card">
                    <h3>Notas</h3>
                    <textarea id="notasTextarea" placeholder="Clique para adicionar nota"></textarea>
                </section>
            </div>

            <section class="card">
                <div class="card-header">
                    <h2>Listagem de Apostas</h2>
                    <div class="actions"><button id="novaApostaBtn" class="button-primary">Nova Aposta</button><button class="button-icon">📥</button><button class="button-icon button-danger">🗑️</button></div>
                </div>
                <div class="bets-list">
                    <div class="bets-grid-container grid-header">
                        <div class="grid-cell">ID</div>
                        <div class="grid-cell">Data</div>
                        <div class="grid-cell">Nome</div>
                        <div class="grid-cell">Casa</div>
                        <div class="grid-cell">Obs</div>
                        <div class="grid-cell">Resultado</div>
                        <div class="grid-cell">Tipo</div>
                        <div class="grid-cell">Status</div>
                        <div class="grid-cell">Ações</div>
                    </div>
                </div>
            </section>
        </div>

        <div class="modal-overlay" id="modalNovaAposta">
            <div class="modal-content">
                <form id="formNovaAposta">
                    <div class="modal-header">
                        <h2>Nova Aposta</h2><button type="button" class="close-button" id="fecharModalBtn">&times;</button>
                    </div>
                    <fieldset>
                        <legend><span>1</span> Informações Gerais</legend>
                        <div class="form-grid-double">
                            <div><label for="data">Data</label><input type="date" id="data" required></div>
                            <div><label for="nomeConta">Nome (Conta)</label><input type="text" id="nomeConta" placeholder="Nome (Conta)"></div>
                        </div>
                        <div class="form-grid-double">
                            <div><label for="obs1">Observação</label><input type="text" id="obs1" placeholder="Observações 1"></div>
                            <div><label for="obs2">Observação 2</label><input type="text" id="obs2" placeholder="Observações 2"></div>
                        </div>
                        <div><label for="tipoAposta">Tipo de aposta</label><select id="tipoAposta">
                                <option value="Normal">Normal</option>
                                <option value="Multipla">Múltipla</option>
                                <option value="Surebet">Surebet</option>
                                <option value="Rodadas Gratis">Rodadas Gratis</option>
                                <option value="Metodos">Metodos</option>
                                <option value="Freebet">Freebet</option>
                            </select>
                        </div>
                    </fieldset>
                    <fieldset>
                        <legend><span>2</span> Dados da Aposta</legend>
                        <div class="form-grid-double">
                            <div><label for="casaApostas">Casa de apostas</label><input type="text" id="casaApostas" placeholder="Nome da casa de apostas"></div>
                            <div><label for="lucroTotalPrevisto">Valor Apostado (R$)</label><input type="number" step="0.01" id="lucroTotalPrevisto" placeholder="Ex: 150.00"></div>
                        </div>
                    </fieldset>
                    <fieldset>
                        <legend><span>3</span> Gestão de Resultados</legend>
                        <div><label for="resultadoLucroTotal">Lucro (Resultado Final) (R$)</label><input type="number" step="0.01" id="resultadoLucroTotal" placeholder="Ex: 100.00 ou -50.00"></div><label style="margin-top: 1rem;">Status da Aposta</label>
                        <div class="status-options"><input type="radio" id="statusConcluido" name="status" value="Concluído" checked><label for="statusConcluido">✅ Concluído</label><input type="radio" id="statusAndamento" name="status" value="Em andamento"><label for="statusAndamento">🕒 Em andamento</label><input type="radio" id="statusFreebet" name="status" value="Aguardando Freebet"><label for="statusFreebet">🔄 Aguardando Freebet</label></div>
                    </fieldset>
                    <div class="modal-footer"><button type="button" class="button-secondary" id="cancelarBtn">Cancelar</button><button type="submit" class="button-primary">Salvar Aposta</button></div>
                </form>
            </div>
        </div>

    </div>
    <script>
        // ======================= VARIÁVEIS GLOBAIS =======================
        let idApostaEmEdicao = null;
        let meuGrafico = null;
        let chartView = 'daily';
        let filtrosAtuais = {
            nome: '',
            casa: 'todas',
            tipo: 'todos',
            status: 'todos'
        };
        let authMode = 'login';

        // ======================= CONFIGURAÇÃO DO SUPABASE =======================
        const SUPABASE_URL = 'https://veswuzzftcqvpxfqithr.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZlc3d1enpmdGNxdnB4ZnFpdGhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyOTk2MjAsImV4cCI6MjA3Mjg3NTYyMH0.W630ZPEZ25TmIZOL0OjbBIBRUgaT6REiSSILzuBVK4g';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // ======================= LÓGICA PRINCIPAL DA APLICAÇÃO =======================
        document.addEventListener('DOMContentLoaded', () => {

            // --- SELETORES GERAIS ---
            const authContainer = document.getElementById('auth-container');
            const appContainer = document.getElementById('app-container');
            const authForm = document.getElementById('auth-form');
            const authTitle = document.getElementById('auth-title');
            const authButton = document.getElementById('auth-button');
            const authMessage = document.getElementById('auth-message');
            const authToggleButton = document.getElementById('auth-toggle-button');
            const authError = document.getElementById('auth-error');
            const logoutButton = document.getElementById('logout-button');
            const userEmailDisplay = document.getElementById('userEmailDisplay');
            const subscriptionStatusDisplay = document.getElementById('subscription-status');
            const appContent = document.getElementById('app-content');

            // --- LÓGICA DE AUTENTICAÇÃO ---

            async function checkUserSession() {
                const {
                    data: {
                        session
                    }
                } = await supabaseClient.auth.getSession();
                if (session) {
                    const {
                        data: profile,
                        error
                    } = await supabaseClient
                        .from('profiles')
                        .select('subscription_expires_at, role')
                        .eq('id', session.user.id)
                        .single();

                    if (error) {
                        console.error("Erro ao buscar perfil:", error);
                        await supabaseClient.auth.signOut();
                        showAuthScreen();
                        return;
                    }

                    const expirationDate = new Date(profile.subscription_expires_at);
                    const hoje = new Date();
                    const diasRestantes = Math.ceil((expirationDate - hoje) / (1000 * 60 * 60 * 24));

                    if (diasRestantes > 0) {
                        subscriptionStatusDisplay.textContent = `${diasRestantes} dias restantes`;
                        subscriptionStatusDisplay.className = 'subscription-status active';
                        appContent.style.display = 'block';
                        initializeApp(profile.role === 'admin');
                    } else {
                        subscriptionStatusDisplay.textContent = 'Plano Expirado';
                        subscriptionStatusDisplay.className = 'subscription-status expired';
                        appContent.style.display = 'none'; // Esconde a aplicação
                    }

                    authContainer.style.display = 'none';
                    appContainer.style.display = 'block';
                    userEmailDisplay.textContent = session.user.email;

                } else {
                    showAuthScreen();
                }
            }

            function showAuthScreen() {
                authContainer.style.display = 'flex';
                appContainer.style.display = 'none';
            }

            function updateAuthUI() {
                authTitle.textContent = authMode === 'login' ? 'Login' : 'Criar Conta';
                authButton.textContent = authMode === 'login' ? 'Entrar' : 'Cadastrar';
                authMessage.textContent = authMode === 'login' ? 'Não tem uma conta?' : 'Já tem uma conta?';
                authToggleButton.textContent = authMode === 'login' ? 'Crie uma agora' : 'Faça login';
                authError.textContent = '';
            }

            authToggleButton.addEventListener('click', () => {
                authMode = authMode === 'login' ? 'signup' : 'login';
                updateAuthUI();
            });

            authForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                authError.textContent = '';
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                let response;
                if (authMode === 'login') {
                    response = await supabaseClient.auth.signInWithPassword({
                        email,
                        password
                    });
                } else {
                    response = await supabaseClient.auth.signUp({
                        email,
                        password
                    });
                    if (!response.error) {
                        alert('Cadastro realizado! Por favor, verifique seu email para confirmar a conta.');
                        authMode = 'login';
                        updateAuthUI();
                    }
                }

                if (response.error) {
                    authError.textContent = response.error.message;
                } else {
                    checkUserSession();
                }
            });

            logoutButton.addEventListener('click', async () => {
                await supabaseClient.auth.signOut();
                checkUserSession();
            });

            // --- FUNÇÃO DE INICIALIZAÇÃO DA APLICAÇÃO PRINCIPAL ---
            function initializeApp(isAdmin) {

                // --- SELETORES DA APLICAÇÃO ---
                const novaApostaBtn = document.getElementById('novaApostaBtn');
                const novaApostaHeaderBtn = document.getElementById('novaApostaHeaderBtn');
                const modal = document.getElementById('modalNovaAposta');
                const fecharModalBtn = document.getElementById('fecharModalBtn');
                const cancelarBtn = document.getElementById('cancelarBtn');
                const formNovaAposta = document.getElementById('formNovaAposta');
                const betsListContainer = document.querySelector('.bets-list');
                const filtroNomeInput = document.getElementById('filtroNome');
                const filtroCasaSelect = document.getElementById('filtroCasa');
                const filtroTipoSelect = document.getElementById('filtroTipo');
                const filtroStatusSelect = document.getElementById('filtroStatus');
                const limparFiltrosBtn = document.getElementById('limparFiltrosBtn');
                const chartDailyBtn = document.getElementById('chartDailyBtn');
                const chartMonthlyBtn = document.getElementById('chartMonthlyBtn');
                const chartTitle = document.getElementById('chartTitle');
                const notasTextarea = document.getElementById('notasTextarea');

                // PAINEL DE ADMIN
                const adminPanel = document.getElementById('admin-panel');
                const userSelect = document.getElementById('user-select');
                const daysToAddInput = document.getElementById('days-to-add');
                const addDaysBtn = document.getElementById('add-days-btn');
                const adminMessage = document.getElementById('admin-message');

                if (isAdmin) {
                    adminPanel.style.display = 'block';
                    loadAdminPanel();
                }

                async function loadAdminPanel() {
                    const {
                        data: profiles,
                        error
                    } = await supabaseClient.from('profiles').select('id, email');
                    if (error) {
                        console.error("Erro ao carregar perfis para admin:", error);
                        return;
                    }
                    userSelect.innerHTML = '';
                    profiles.forEach(profile => {
                        const option = document.createElement('option');
                        option.value = profile.id;
                        option.textContent = profile.email;
                        userSelect.appendChild(option);
                    });
                }

                addDaysBtn.addEventListener('click', async () => {
                    const userId = userSelect.value;
                    const days = parseInt(daysToAddInput.value, 10);
                    if (!userId || !days) {
                        adminMessage.textContent = "Por favor, selecione um utilizador e insira o número de dias.";
                        return;
                    }

                    const {
                        data: profile,
                        error: fetchError
                    } = await supabaseClient
                        .from('profiles')
                        .select('subscription_expires_at')
                        .eq('id', userId)
                        .single();

                    if (fetchError) {
                        adminMessage.textContent = `Erro ao buscar perfil: ${fetchError.message}`;
                        return;
                    }

                    const currentExpiration = new Date(profile.subscription_expires_at);
                    const newExpiration = new Date(currentExpiration.setDate(currentExpiration.getDate() + days));

                    const {
                        error: updateError
                    } = await supabaseClient
                        .from('profiles')
                        .update({
                            subscription_expires_at: newExpiration.toISOString()
                        })
                        .eq('id', userId);

                    if (updateError) {
                        adminMessage.textContent = `Erro ao atualizar subscrição: ${updateError.message}`;
                    } else {
                        adminMessage.textContent = `Subscrição de ${userSelect.options[userSelect.selectedIndex].text} atualizada com sucesso!`;
                        daysToAddInput.value = '';
                    }
                });


                // --- FUNÇÕES DA APLICAÇÃO ---
                async function carregarApostas() {
                    let query = supabaseClient.from('apostas').select('*');
                    if (filtrosAtuais.nome) {
                        query = query.ilike('nome_conta', `%${filtrosAtuais.nome}%`);
                    }
                    if (filtrosAtuais.casa && filtrosAtuais.casa !== 'todas') {
                        query = query.eq('casa_apostas', filtrosAtuais.casa);
                    }
                    if (filtrosAtuais.tipo && filtrosAtuais.tipo !== 'todos') {
                        query = query.eq('tipo_aposta', filtrosAtuais.tipo);
                    }
                    if (filtrosAtuais.status && filtrosAtuais.status !== 'todos') {
                        query = query.eq('status', filtrosAtuais.status);
                    }
                    query = query.order('id', {
                        ascending: false
                    });

                    const {
                        data: apostas,
                        error
                    } = await query;
                    if (error) {
                        console.error('Erro ao buscar apostas:', error);
                        return;
                    }

                    renderizarLista(apostas);
                    atualizarPainelResumo(apostas);
                    renderizarGrafico(apostas);
                    if (filtrosAtuais.casa === 'todas') {
                        preencherFiltroCasas(apostas);
                    }
                }

                function renderizarLista(apostas) {
                    betsListContainer.querySelectorAll('.grid-row').forEach(row => row.remove());
                    const emptyState = betsListContainer.querySelector('.empty-state');
                    if (emptyState) emptyState.remove();

                    if (apostas.length === 0) {
                        betsListContainer.insertAdjacentHTML('beforeend', `<div class="empty-state"><p>Nenhuma aposta encontrada.</p></div>`);
                    } else {
                        apostas.forEach(aposta => {
                            const apostaElement = document.createElement('div');
                            apostaElement.classList.add('grid-row');
                            const dataFormatada = aposta.data ? new Date(aposta.data + 'T00:00:00').toLocaleDateString('pt-BR') : 'N/A';
                            const resultado = aposta.resultado_lucro_total || 0;
                            const resultadoClasse = resultado > 0 ? 'resultado-positivo' : resultado < 0 ? 'resultado-negativo' : '';
                            const statusClass = (aposta.status || '').toLowerCase().replace(/ /g, '-').replace('ú', 'u');

                            // MODIFICADO: Adicionado 'data-label' para responsividade
                            apostaElement.innerHTML = `
                                <div class="grid-cell" data-label="ID">${aposta.id}</div>
                                <div class="grid-cell" data-label="Data">${dataFormatada}</div>
                                <div class="grid-cell" data-label="Nome">${aposta.nome_conta || '-'}</div>
                                <div class="grid-cell" data-label="Casa">${aposta.casa_apostas || '-'}</div>
                                <div class="grid-cell" data-label="Obs">${aposta.observacao1 || '-'}</div>
                                <div class="grid-cell ${resultadoClasse}" data-label="Resultado">${resultado.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</div>
                                <div class="grid-cell" data-label="Tipo">${aposta.tipo_aposta || '-'}</div>
                                <div class="grid-cell" data-label="Status"><span class="status-badge status-${statusClass}">${aposta.status}</span></div>
                                <div class="grid-cell action-buttons" data-label="Ações">
                                    <button class="action-btn btn-edit" title="Editar Aposta" data-id="${aposta.id}">✏️</button>
                                    <button class="action-btn btn-delete" title="Excluir Aposta" data-id="${aposta.id}">🗑️</button>
                                </div>
                            `;
                            betsListContainer.appendChild(apostaElement);
                        });
                    }
                }

                function atualizarPainelResumo(apostas) {
                    const lucroTotalEl = document.getElementById('lucroTotalValue');
                    const lucroMedioEl = document.getElementById('lucroMedioValue');
                    const apostasAndamentoEl = document.getElementById('apostasAndamentoValue');
                    const apostasConcluidasEl = document.getElementById('apostasConcluidasValue');
                    const concluidas = apostas.filter(aposta => aposta.status === 'Concluído');
                    const emAndamento = apostas.filter(aposta => aposta.status === 'Em andamento');
                    const lucroTotal = concluidas.reduce((total, aposta) => total + (aposta.resultado_lucro_total || 0), 0);
                    const lucroMedio = concluidas.length > 0 ? lucroTotal / concluidas.length : 0;
                    const formatarMoeda = (valor) => valor.toLocaleString('pt-BR', {
                        style: 'currency',
                        currency: 'BRL'
                    });
                    lucroTotalEl.textContent = formatarMoeda(lucroTotal);
                    lucroMedioEl.textContent = formatarMoeda(lucroMedio);
                    apostasConcluidasEl.textContent = concluidas.length;
                    apostasAndamentoEl.textContent = emAndamento.length;
                }

                function renderizarGrafico(apostas) {
                    const ctx = document.getElementById('graficoLucroDiario').getContext('2d');
                    if (meuGrafico) meuGrafico.destroy();
                    let chartConfig;
                    if (chartView === 'daily') {
                        chartTitle.textContent = 'Lucro Diário';
                        const hoje = new Date();
                        const mesAtual = hoje.getMonth();
                        const anoAtual = hoje.getFullYear();
                        const diasNoMes = new Date(anoAtual, mesAtual + 1, 0).getDate();
                        const lucrosPorDia = Array(diasNoMes).fill(0);
                        const apostasDoMes = apostas.filter(a => a.data && a.status === 'Concluído' && new Date(a.data + 'T00:00:00').getMonth() === mesAtual && new Date(a.data + 'T00:00:00').getFullYear() === anoAtual);
                        let maiorLucroDiario = 0;
                        apostasDoMes.forEach(aposta => {
                            const dia = new Date(aposta.data + 'T00:00:00').getDate();
                            lucrosPorDia[dia - 1] += aposta.resultado_lucro_total || 0;
                            if (lucrosPorDia[dia - 1] > maiorLucroDiario) maiorLucroDiario = lucrosPorDia[dia - 1];
                        });
                        const topoGrafico = Math.ceil(maiorLucroDiario / 100) * 100;
                        const labels = Array.from({
                            length: diasNoMes
                        }, (_, i) => (i + 1).toString().padStart(2, '0'));
                        chartConfig = getChartConfig(labels, lucrosPorDia, 'Diário', mesAtual, topoGrafico > 0 ? topoGrafico : 100);
                    } else if (chartView === 'monthly') {
                        chartTitle.textContent = 'Lucro Mensal';
                        const lucrosPorMes = {};
                        const apostasConcluidas = apostas.filter(a => a.status === 'Concluído' && a.data);
                        apostasConcluidas.forEach(aposta => {
                            const dataAposta = new Date(aposta.data + 'T00:00:00');
                            const mesKey = `${dataAposta.getFullYear()}-${String(dataAposta.getMonth()).padStart(2, '0')}`;
                            lucrosPorMes[mesKey] = (lucrosPorMes[mesKey] || 0) + (aposta.resultado_lucro_total || 0);
                        });
                        const mesesOrdenados = Object.keys(lucrosPorMes).sort();
                        const labels = mesesOrdenados.map(key => new Date(key.split('-')[0], key.split('-')[1]).toLocaleString('pt-BR', {
                            month: 'short',
                            year: '2-digit'
                        }));
                        const data = mesesOrdenados.map(key => lucrosPorMes[key]);
                        const maiorLucroMensal = Math.max(...data, 0);
                        const topoGrafico = Math.ceil(maiorLucroMensal / 1000) * 1000;
                        chartConfig = getChartConfig(labels, data, 'Mensal', null, topoGrafico > 0 ? topoGrafico : 1000);
                    }
                    meuGrafico = new Chart(ctx, chartConfig);
                }

                function getChartConfig(labels, data, tipoTooltip, mesAtual, maximoY) {
                    return {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: `Lucro ${tipoTooltip}`,
                                data: data,
                                backgroundColor: 'rgba(59, 130, 246, 0.8)',
                                borderColor: 'rgba(59, 130, 246, 1)',
                                borderWidth: 1,
                                borderRadius: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: maximoY,
                                    ticks: {
                                        color: 'rgba(255, 255, 255, 0.5)'
                                    },
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    }
                                },
                                x: {
                                    ticks: {
                                        color: 'rgba(255, 255, 255, 0.5)'
                                    },
                                    grid: {
                                        display: false
                                    },
                                    border: {
                                        display: false
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    enabled: true,
                                    backgroundColor: '#1a1a1a',
                                    titleColor: '#fff',
                                    bodyColor: '#fff',
                                    borderColor: 'var(--primary-color)',
                                    borderWidth: 1,
                                    displayColors: false,
                                    callbacks: {
                                        title: (ctx) => tipoTooltip === 'Diário' ? `${ctx[0].label}/${(mesAtual + 1).toString().padStart(2, '0')}` : ctx[0].label,
                                        label: (ctx) => `Lucro ${tipoTooltip}: ${ctx.raw.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`
                                    }
                                }
                            }
                        }
                    };
                }

                async function salvarAposta(apostaData) {
                    const {
                        data: {
                            user
                        }
                    } = await supabaseClient.auth.getUser();
                    if (!user) {
                        alert('Sessão expirada. Por favor, faça login novamente.');
                        return;
                    }
                    apostaData.user_id = user.id;

                    const {
                        error
                    } = await supabaseClient.from('apostas').insert([apostaData]);
                    if (error) {
                        console.error('Erro ao salvar aposta:', error);
                        alert('Não foi possível salvar a aposta.');
                    } else {
                        fecharModal();
                        carregarApostas();
                    }
                }

                async function atualizarAposta(apostaData) {
                    const {
                        error
                    } = await supabaseClient.from('apostas').update(apostaData).eq('id', idApostaEmEdicao);
                    if (error) {
                        console.error('Erro ao atualizar aposta:', error);
                        alert('Não foi possível atualizar a aposta.');
                    } else {
                        fecharModal();
                        carregarApostas();
                    }
                }

                async function excluirAposta(id) {
                    if (confirm('Tem certeza que deseja excluir esta aposta?')) {
                        const {
                            error
                        } = await supabaseClient.from('apostas').delete().eq('id', id);
                        if (error) {
                            console.error('Erro ao excluir aposta:', error);
                            alert('Não foi possível excluir a aposta.');
                        } else {
                            carregarApostas();
                        }
                    }
                }

                async function iniciarEdicao(id) {
                    const {
                        data: aposta,
                        error
                    } = await supabaseClient.from('apostas').select('*').eq('id', id).single();
                    if (error) {
                        console.error('Erro ao buscar aposta para edição:', error);
                        alert('Não foi possível carregar os dados da aposta.');
                        return;
                    }
                    idApostaEmEdicao = id;
                    document.querySelector('#modalNovaAposta h2').textContent = 'Editar Aposta';
                    preencherFormulario(aposta);
                    abrirModal();
                }

                function preencherFormulario(aposta) {
                    document.getElementById('data').value = aposta.data;
                    document.getElementById('nomeConta').value = aposta.nome_conta;
                    document.getElementById('obs1').value = aposta.observacao1;
                    document.getElementById('obs2').value = aposta.observacao2;
                    document.getElementById('tipoAposta').value = aposta.tipo_aposta;
                    document.getElementById('casaApostas').value = aposta.casa_apostas;
                    document.getElementById('lucroTotalPrevisto').value = aposta.valor_lucro_total_previsto;
                    document.getElementById('resultadoLucroTotal').value = aposta.resultado_lucro_total;
                    document.querySelectorAll('input[name="status"]').forEach(radio => {
                        radio.checked = radio.value === aposta.status;
                    });
                }

                function preencherFiltroCasas(apostas) {
                    const casas = [...new Set(apostas.map(aposta => aposta.casa_apostas).filter(Boolean))];
                    const casaSelecionada = filtroCasaSelect.value;
                    filtroCasaSelect.innerHTML = '<option value="todas">Todas as Casas</option>';
                    casas.sort().forEach(casa => {
                        const option = document.createElement('option');
                        option.value = casa;
                        option.textContent = casa;
                        filtroCasaSelect.appendChild(option);
                    });
                    filtroCasaSelect.value = casaSelecionada;
                }

                async function salvarNotas() {
                    const {
                        data: {
                            user
                        }
                    } = await supabaseClient.auth.getUser();
                    if (user) {
                        localStorage.setItem(`notas-${user.id}`, notasTextarea.value);
                    }
                }

                async function carregarNotas() {
                    const {
                        data: {
                            user
                        }
                    } = await supabaseClient.auth.getUser();
                    if (user) {
                        const notasSalvas = localStorage.getItem(`notas-${user.id}`);
                        if (notasSalvas) {
                            notasTextarea.value = notasSalvas;
                        }
                    }
                }

                const abrirModal = () => modal.classList.add('active');
                const fecharModal = () => {
                    modal.classList.remove('active');
                    formNovaAposta.reset();
                    idApostaEmEdicao = null;
                    document.querySelector('#modalNovaAposta h2').textContent = 'Nova Aposta';
                }

                // --- LISTENERS DA APLICAÇÃO ---
                const abrirModalNovaAposta = (e) => {
                    if (e) e.preventDefault();
                    idApostaEmEdicao = null;
                    formNovaAposta.reset();
                    document.querySelector('#modalNovaAposta h2').textContent = 'Nova Aposta';
                    const hoje = new Date();
                    const ano = hoje.getFullYear();
                    const mes = String(hoje.getMonth() + 1).padStart(2, '0');
                    const dia = String(hoje.getDate()).padStart(2, '0');
                    document.getElementById('data').value = `${ano}-${mes}-${dia}`;
                    abrirModal();
                };

                novaApostaBtn.addEventListener('click', abrirModalNovaAposta);
                novaApostaHeaderBtn.addEventListener('click', abrirModalNovaAposta);
                fecharModalBtn.addEventListener('click', fecharModal);
                cancelarBtn.addEventListener('click', fecharModal);
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) fecharModal();
                });
                betsListContainer.addEventListener('click', function(event) {
                    const target = event.target.closest('.action-btn');
                    if (!target) return;
                    const apostaId = target.dataset.id;
                    if (target.classList.contains('btn-delete')) {
                        excluirAposta(apostaId);
                    } else if (target.classList.contains('btn-edit')) {
                        iniciarEdicao(apostaId);
                    }
                });

                filtroNomeInput.addEventListener('keyup', () => {
                    filtrosAtuais.nome = filtroNomeInput.value;
                    carregarApostas();
                });
                filtroCasaSelect.addEventListener('change', () => {
                    filtrosAtuais.casa = filtroCasaSelect.value;
                    carregarApostas();
                });
                filtroTipoSelect.addEventListener('change', () => {
                    filtrosAtuais.tipo = filtroTipoSelect.value;
                    carregarApostas();
                });
                filtroStatusSelect.addEventListener('change', () => {
                    filtrosAtuais.status = filtroStatusSelect.value;
                    carregarApostas();
                });
                limparFiltrosBtn.addEventListener('click', () => {
                    filtrosAtuais = {
                        nome: '',
                        casa: 'todas',
                        tipo: 'todos',
                        status: 'todos'
                    };
                    filtroNomeInput.value = '';
                    filtroCasaSelect.value = 'todos';
                    filtroTipoSelect.value = 'todos';
                    filtroStatusSelect.value = 'todos';
                    carregarApostas();
                });
                chartDailyBtn.addEventListener('click', () => {
                    chartView = 'daily';
                    chartDailyBtn.classList.add('active');
                    chartMonthlyBtn.classList.remove('active');
                    carregarApostas();
                });
                chartMonthlyBtn.addEventListener('click', () => {
                    chartView = 'monthly';
                    chartMonthlyBtn.classList.add('active');
                    chartDailyBtn.classList.remove('active');
                    carregarApostas();
                });
                notasTextarea.addEventListener('keyup', salvarNotas);

                formNovaAposta.addEventListener('submit', async (event) => {
                    event.preventDefault();
                    const submitButton = formNovaAposta.querySelector('button[type="submit"]');
                    submitButton.disabled = true;
                    const apostaData = {
                        data: document.getElementById('data').value,
                        nome_conta: document.getElementById('nomeConta').value,
                        observacao1: document.getElementById('obs1').value,
                        observacao2: document.getElementById('obs2').value,
                        tipo_aposta: document.getElementById('tipoAposta').value,
                        casa_apostas: document.getElementById('casaApostas').value,
                        valor_lucro_total_previsto: parseFloat(document.getElementById('lucroTotalPrevisto').value) || 0,
                        status: document.querySelector('input[name="status"]:checked').value,
                        resultado_lucro_total: parseFloat(document.getElementById('resultadoLucroTotal').value) || null
                    };
                    if (idApostaEmEdicao) {
                        submitButton.textContent = 'Atualizando...';
                        await atualizarAposta(apostaData);
                    } else {
                        submitButton.textContent = 'Salvando...';
                        await salvarAposta(apostaData);
                    }
                    submitButton.disabled = false;
                    submitButton.textContent = 'Salvar Aposta';
                });

                // --- 4. INICIALIZAÇÃO DA APLICAÇÃO ---
                carregarApostas();
                carregarNotas();
            }

            // --- INICIALIZAÇÃO GERAL ---
            checkUserSession();
        });
    </script>
</body>
</html>

